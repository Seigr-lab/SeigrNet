# Seigr.net — Web App Instructions (for developer / automation agents)

**Purpose:**  
This repository contains a lightweight, maintainable Python web application that serves the Seigr public website (`seigr.net`). The app is intentionally simple, dependency-free (Python stdlib only), modular, and follows Seigr's non-monolithic architecture rules:

- HTML lives in `templates/*.html` files  
- JavaScript lives in `static/js/*.js` files  
- CSS lives in `static/css/*.css` files  
- No mixing of languages inside files (no `<script>` building HTML inside JS files, no CSS inside HTML except minimal critical inline allowed for progressive rendering)

This `.instructions.md` is the authoritative specification for implementers and agent tooling (Copilot / Grok Code Fast). Follow it literally.

---

## High-level requirements

1. **Server:** Pure-Python WSGI application using `wsgiref.simple_server` (or equivalent stdlib WSGI interface). **No third-party web frameworks** (Flask, Django, FastAPI, etc.) may be used.
2. **Routing:** Minimal custom router mapping paths to view functions inside `app/` (e.g., `app/routes.py`). All routes and APIs must be explicitly declared.
3. **Templating:** Use **file-based HTML templates** under `templates/`. Template substitution must be done with `string.Template` or a small custom safe templating helper implemented in `app/template.py`. **Do not** import or rely on any external templating packages.
4. **Static files:** Serve static files from `static/` and ensure caching headers are set. Use `static/js`, `static/css`, `static/img`, `static/fonts`.
5. **Modularity:** Each feature lives in its own module/folder under `app/`. No single file contains the whole app.
6. **Content storage:** Site content (toolset previews, roadmap items, beekeeping pages, music pages, manifesto) is stored as **HTML fragments** in `content/` and metadata in **JSON** files. No third-party markdown libs. If content authors prefer Markdown, it must be converted to HTML by a small included converter function (limited subset) in `app/md2html.py`.
7. **Admin/editing:** A README-based content workflow: content author edits `content/` files and commits. The web app reads content files at startup and can reload them on demand (via a secure admin route guarded by a secret key configured in `config.py`).
8. **Accessibility & responsivity:** Templates must be accessible and responsive (mobile-first CSS). Use progressive enhancement: HTML + CSS for structure; JS only for tab interactions and progressive features.
9. **Testing & CI:** Provide unit tests (stdlib `unittest`) and a simple CI script (`scripts/run_tests.sh`) that runs tests and static checks.
10. **Deployment:** Provide a simple `serve.py` entrypoint to run a production-ready WSGI server using `wsgiref.simple_server` with instructions for reverse-proxying (nginx) and a sample `systemd` service file in `deploy/`.

---

## Folder structure (must be created exactly)

```
seigr-net/
├── app/
│   ├── __init__.py
│   ├── config.py                # site config (site title, admin secret, caching)
│   ├── server.py                # wsgi app factory + static file serving
│   ├── routes.py                # route registrations
│   ├── handlers/
│   │   ├── landing.py
│   │   ├── lab.py
│   │   ├── toolsets.py
│   │   ├── roadmap.py
│   │   ├── beekeeping.py
│   │   └── music.py
│   ├── template.py              # small safe template renderer (string.Template based)
│   ├── md2html.py               # minimal markdown subset converter (optional)
│   └── utils.py                 # helper utilities (safe join, cache headers, slugify)
│
├── templates/
│   ├── base.html
│   ├── landing.html
│   ├── lab.html
│   ├── toolset_card.html
│   ├── toolset_detail.html
│   ├── roadmap.html
│   ├── roadmap_card.html
│   ├── beekeeping.html
│   └── music.html
│
├── static/
│   ├── css/
│   │   ├── main.css
│   │   └── responsive.css
│   ├── js/
│   │   ├── tabs.js
│   │   └── toolset_preview.js
│   └── img/
│       └── (images used by site)
│
├── content/
│   ├── manifesto.html
│   ├── lab/
│   │   ├── toolsets.json        # metadata list (title, slug, short_html, detail_html_path)
│   │   └── toolsets/            # each toolset detail as HTML fragment
│   │       └── seigrtoolsetcrypto.html
│   ├── roadmap/
│   │   ├── roadmap.json
│   │   └── items/
│   ├── beekeeping.html
│   └── music.html
│
├── tests/
│   ├── test_routes.py
│   ├── test_template.py
│   └── test_content_loading.py
│
├── deploy/
│   ├── nginx_sample.conf
│   └── seigr_net.service        # sample systemd service
│
├── scripts/
│   ├── run.sh                   # start dev server
│   └── run_tests.sh
│
├── README.md
├── LICENSE
└── serve.py                     # entrypoint script (imports app.server.create_app)
```

---

## Detailed content format rules

### Toolset metadata (`content/lab/toolsets.json`)
A JSON list of objects. Each object must contain:
```json
{
  "title": "Seigr Toolset Crypto",
  "slug": "seigr-toolset-crypto",
  "short_html": "A short HTML fragment for the preview card (no <body> tag).",
  "detail_path": "lab/toolsets/seigrtoolsetcrypto.html",
  "thumbnail": "static/img/toolset-seigr.png",
  "tags": ["crypto", "toolset"]
}
```
**Notes:**
- `slug` is used in URLs: `/lab/toolsets/<slug>/`
- `short_html` should be safe HTML (authors must sanitize before committing)
- `detail_path` must be relative to `content/` and point to an HTML fragment file

### Roadmap (`content/roadmap/roadmap.json`)
A JSON array of roadmap items:
```json
{
  "title": "Seigr OS Core",
  "slug": "seigr-os-core",
  "status": "active",   // active | planning | stalled | done
  "summary_html": "<p>Short summary...</p>",
  "detail_path": "roadmap/items/seigr-os-core.html",
  "priority": 1
}
```

### Manifesto and other pages
- `content/manifesto.html`, `content/beekeeping.html`, `content/music.html` are full HTML fragments: inner content only (no DOCTYPE or `<html>` root).
- All content files must be valid UTF-8.

---

## Routing & URLs (must be supported)

- `GET /` → landing page, loads `templates/landing.html` and `content/manifesto.html`
- `GET /lab` → Seigr Lab overview; loads `templates/lab.html` and reads `content/lab/toolsets.json`
- `GET /lab/toolsets` → toolsets list (can be same as `/lab` but may return full list as JSON if `Accept: application/json`)
- `GET /lab/toolsets/<slug>/` → toolset detail page rendered from `content/lab/toolsets/<detail_path>`
- `GET /lab/roadmap` → roadmap list (cards)
- `GET /lab/roadmap/<slug>/` → roadmap item detail (optional)
- `GET /beekeeping` → beekeeping page
- `GET /music` → music page
- `GET /static/...` → serve static files with correct `Content-Type` and caching headers
- `GET /api/toolsets` → returns JSON representation of `toolsets.json` (for JS-driven previews)
- `POST /admin/reload` → secure admin endpoint to reload content files (must require `X-Admin-Token` header matching `config.ADMIN_TOKEN`)

**All 404s** must be handled gracefully with `templates/404.html`.

---

## Templates: required placeholders & patterns

Every template must extend `base.html` style (simple include pattern; you may implement include by reading partial HTML files and performing token substitution):

**`base.html`** must include:
- `<head>` meta tags, canonical link, `main.css` link
- top navigation with tabs: Landing / Lab / Beekeeping / Music
- footer with social links and sponsor link
- `<!-- CONTENT -->` placeholder where view HTML is injected

**Card templates**:
- `toolset_card.html` must be a small fragment that accepts `title`, `short_html`, `thumbnail`, `slug`, `tags`.

**Detail templates**:
- `toolset_detail.html` must accept `title`, `content_html` (from `detail_path`), `metadata` and provide shareable canonical URL and meta tags (og: tags).

---

## JavaScript requirements

- `static/js/tabs.js` handles tab highlighting and client-side navigation (progressive enhancement only).
- `static/js/toolset_preview.js` loads `/api/toolsets` and populates preview cards if desired.
- All JS must be vanilla (no frameworks). Keep scripts minimal and non-blocking (load at bottom with `defer` or `async` patterns where appropriate).
- All JS files must be stored under `static/js/` and not inline in HTML files (except a single small inline snippet if strictly necessary for first-paint).

---

## CSS requirements

- `static/css/main.css` contains site styles.
- `static/css/responsive.css` contains mobile-first responsive rules.
- Use CSS variables for theming and maintain high contrast for accessibility.
- No external CSS frameworks (Bootstrap, Tailwind, etc.). Keep CSS modular: `base`, `layout`, `components`, `cards`.

---

## Security & content workflow

- The admin reload endpoint must be protected by `config.ADMIN_TOKEN` and only accept `POST`. The token must be set by environment variable `SEIGR_ADMIN_TOKEN` in production.
- All user-supplied or third-party HTML fragments must be sanitized at authoring time. For now, the content is maintained by repository authors — content hygiene is a human process. The app must never attempt to sanitize on display (authors are responsible). Add a `WARNING` note in `README.md`.
- Avoid executing any dynamic code from content (no inline `<script>` allowed in HTML fragments). If a content fragment includes `<script>`, the server must refuse to load it and log a warning.

---

## Testing

- `tests/test_routes.py` must assert all routes return HTTP 200 and that static files are served with expected content types.
- `tests/test_template.py` must validate template rendering with a minimal context (no network).
- `tests/test_content_loading.py` must load `content/` JSON and ensure required fields exist and slugs are unique.
- `scripts/run_tests.sh` uses `python -m unittest discover` and exits non-zero on failure.

---

## Developer / Grok instructions (agent-specific)

When using Copilot/Grok Code Fast to implement:

1. **Read this file first** and every `templates/*.html` and `content/*` file available in the repo.
2. **Implement the server with pure stdlib** (WSGI + `wsgiref.simple_server`) and `string.Template`-based templating.
3. **Do not** add third-party dependencies. If a suggested dependency is proposed by the agent during coding, the agent must reject it and implement an equivalent in pure Python.
4. Follow the folder structure exactly; unit tests expect that layout.
5. Prefer explicit, readable code over clever one-liners. Add docstrings to all top-level functions and modules.
6. Implement content reloading safely: load JSON and HTML fragments into an in-memory cache; allow admin `POST /admin/reload` to refresh the cache.
7. Provide clear logging (stdlib `logging`) with `INFO` level default and `DEBUG` available via `config.DEBUG = True`.
8. Include a `README.md` snippet explaining how to add a new toolset card (update `toolsets.json` and add `content` fragment).
9. Ensure server gracefully reloads content on file-not-found or parse error: do not crash; log and continue serving existing cached content.

---

## Deployment guidance

- For production, run behind a reverse proxy (nginx) and use `gunicorn` or similar. Because the rule forbids third-party libs for the app itself, running the app under `gunicorn` is optional — if the distributor wants zero third-party server packages, use the `wsgiref` server + nginx proxy (recommended only for low-traffic sites).
- Provide `deploy/nginx_sample.conf` and `deploy/seigr_net.service` (systemd) as reference. Document environment variables: `SEIGR_ADMIN_TOKEN`, `SEIGR_ENV=production`, `SEIGR_BIND=0.0.0.0:8000`.

---

## Performance & caching

- Static files must include `Cache-Control: max-age=31536000, immutable` for hashed resources. For dynamic HTML responses, set `Cache-Control: max-age=60, s-maxage=300` (short caching).
- Implement ETag generation for toolset JSON and content files using a simple hash (e.g., `hashlib.sha256`) of file contents.

---

## Accessibility & SEO

- All pages must include `lang` attribute and proper `<title>` and `<meta name="description">`.
- Use semantic HTML (nav, main, article, section).
- Provide Twitter/OpenGraph meta tags on detail pages for social sharing.

---

## Example minimal flow to add a new Toolset

1. Add a new HTML fragment to `content/lab/toolsets/new-tool.html` with the full description.
2. Add a metadata entry to `content/lab/toolsets.json`:
   ```json
   {
     "title": "New Tool",
     "slug": "new-tool",
     "short_html": "<p>Short preview...</p>",
     "detail_path": "lab/toolsets/new-tool.html",
     "thumbnail": "static/img/new-tool.png",
     "tags": ["example"]
   }
   ```
3. Commit and push. Optionally call `POST /admin/reload` with header `X-Admin-Token: <token>` to hot-reload content.

---

## Final notes

- This web app is intentionally **minimal**, readable, and maintainable. Add features later only after following the same file separation rules.
- Keep the codebase lean and ensure every new file has an accompanying `.instructions.md` if it defines a new module or content area.

